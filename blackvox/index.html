
<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BLACKVOX v3 ‚Äî Playlists √Åudio</title>
<meta name="description" content="Player leve para playlists via playlist.json, com importar/exportar.">
<style>
:root{--bg:#0c0f12;--panel:#141a20;--ring:#232a34;--text:#e9eef3;--muted:#9fb2c7;--brand:#f3b338;}
*{box-sizing:border-box}html,body{margin:0;background:var(--bg);color:var(--text);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
header{padding:24px 16px 8px;text-align:center}
.pill{display:inline-block;font-size:12px;padding:4px 10px;border-radius:999px;background:#1a2330;border:1px solid var(--ring);color:var(--muted)}
h1{margin:6px 0 0;font-size:22px;font-weight:800}
.sub{color:var(--muted);font-size:13px;margin-top:4px}
main{max-width:880px;margin:18px auto 34px;padding:0 16px}
.player{background:linear-gradient(180deg,#0f1520,#0b1118);border:1px solid var(--ring);border-radius:18px;box-shadow:0 10px 40px #0006,inset 0 0 0 1px #0004;padding:16px}
.now{display:flex;gap:12px;justify-content:space-between;align-items:center;background:#111822;border:1px solid var(--ring);border-radius:12px;padding:10px 12px;margin-bottom:12px}
.title{font-weight:700}
.controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
button{border:0;border-radius:10px;padding:9px 12px;font-weight:700;cursor:pointer;background:var(--brand);color:#231a00}
button.sec{background:#1f2832;color:var(--text);border:1px solid var(--ring)}
button.gh{background:transparent;color:var(--muted);border:1px solid var(--ring)}
.toolbar{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
.progress{height:6px;background:#243041;border-radius:4px;overflow:hidden}
.bar{height:100%;width:0%;background:linear-gradient(90deg,#ffd66b,var(--brand))}
.list{display:flex;flex-direction:column;gap:10px;margin:10px 0;max-height:60vh;overflow:auto}
.item{display:flex;justify-content:space-between;align-items:center;gap:10px;background:#111822;border:1px solid var(--ring);border-radius:12px;padding:10px 12px}
.item.active{outline:2px solid var(--brand);box-shadow:0 0 0 3px rgba(243,179,56,.15) inset}
.small{color:var(--muted);font-size:.92rem}
.footer{display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:.9rem;margin-top:10px}
a{color:#86c7ff;text-decoration:none}
input[type="range"]{accent-color:var(--brand);cursor:pointer}
.status-ok{color:#6df3a0}
.status-err{color:#ff8a8a}
.hidden{display:none}
</style>
</head>
<body>
<header>
  <span class="pill">V O V</span>
  <h1>BLACKVOX v3 ‚Äî Playlists √Åudio</h1>
  <div class="sub">Ver ‚Ä¢ Ouvir ‚Ä¢ Vender ‚Ä¢ Viver ‚Äî l√™ <code>playlist.json</code> e tamb√©m importa .json.</div>
</header>

<main>
  <section class="player" aria-label="Player">
    <div class="now">
      <div>
        <div id="status" class="small">Carregando playlist‚Ä¶</div>
        <div id="now" class="title">‚Äî</div>
      </div>
      <div class="controls">
        <button id="prev" class="sec" title="Anterior">‚èÆ</button>
        <button id="play" title="Play/Pause">‚ñ∂Ô∏è</button>
        <button id="next" class="sec" title="Pr√≥xima">‚è≠</button>
        <span class="small">üîà</span>
        <input id="vol" type="range" min="0" max="1" step="0.01" value="0.9">
      </div>
    </div>

    <div class="progress"><div id="bar" class="bar"></div></div>

    <div class="toolbar">
      <button id="btnImport" class="sec">‚Üë Importar playlist (.json)</button>
      <input id="fileJson" type="file" accept="application/json" class="hidden">
      <button id="btnExport" class="gh">‚Üì Exportar playlist</button>
      <button id="btnClear" class="gh">‚úñ Limpar sess√£o</button>
      <a class="gh" href="playlist.json" target="_blank" rel="noopener">ver playlist.json</a>
    </div>

    <div id="list" class="list" aria-label="Lista"></div>

    <audio id="audio" crossorigin="anonymous"></audio>

    <div class="footer">
      <span class="small">Sess√£o salva no navegador (localStorage).</span>
      <span class="small">Dica: prefira MP3 hospedados aqui em <code>/audios/</code> ou em CDN com CORS liberado.</span>
    </div>
  </section>
</main>

<script>
const audio = document.getElementById('audio');
const nowEl = document.getElementById('now');
const statusEl = document.getElementById('status');
const bar = document.getElementById('bar');
const listEl = document.getElementById('list');
const btnPlay = document.getElementById('play');
const btnNext = document.getElementById('next');
const btnPrev = document.getElementById('prev');
const vol = document.getElementById('vol');
const btnImport = document.getElementById('btnImport');
const fileJson = document.getElementById('fileJson');
const btnExport = document.getElementById('btnExport');
const btnClear = document.getElementById('btnClear');

let tracks = [];  // [{title,file}]
let idx = -1;

// UI
function setStatus(msg, ok=false, err=false){
  statusEl.textContent = msg;
  statusEl.classList.toggle('status-ok', ok);
  statusEl.classList.toggle('status-err', err);
}
function render(){
  listEl.innerHTML = '';
  tracks.forEach((t,i)=>{
    const row = document.createElement('div');
    row.className = 'item' + (i===idx?' active':'');
    const left = document.createElement('div');
    left.innerHTML = `<div>${t.title||'Faixa'}</div><div class="small">${t.file}</div>`;
    const right = document.createElement('div');
    const bPlay = document.createElement('button'); bPlay.className='sec'; bPlay.textContent='Tocar';
    const bDel  = document.createElement('button'); bDel.className='gh';  bDel.textContent='Excluir';
    bPlay.onclick = ()=> playAt(i);
    bDel.onclick  = ()=> removeAt(i);
    right.appendChild(bPlay); right.appendChild(bDel);
    row.appendChild(left); row.appendChild(right);
    listEl.appendChild(row);
  });
  nowEl.textContent = (idx>=0 && tracks[idx])? tracks[idx].title : '‚Äî';
}
function setNow(i){
  idx = i;
  render();
  if(i<0 || i>=tracks.length){
    nowEl.textContent = '‚Äî';
    audio.removeAttribute('src');
    return;
  }
  const t = tracks[i];
  nowEl.textContent = t.title || '‚Äî';
  audio.src = t.file;
  localStorage.setItem('BVX_LAST', String(i));
}
function playAt(i){
  setNow(i);
  audio.play().then(()=>setStatus('Tocando', true, false)).catch(err=>{
    console.error(err);
    setStatus('Falha ao tocar (URL ou CORS)', false, true);
    alert('N√£o foi poss√≠vel tocar esta faixa. Hospede em /audios, GitHub Releases, Dropbox (?raw=1) ou outra CDN com CORS.');
  });
}
function removeAt(i){
  tracks.splice(i,1);
  if(idx>=tracks.length) idx = tracks.length-1;
  save(); render();
  if(idx>=0) setNow(idx); else { audio.pause(); setNow(-1); }
}
function save(){ localStorage.setItem('BVX_PLAYLIST', JSON.stringify(tracks)); }
function loadLocal(){
  try{
    const p = JSON.parse(localStorage.getItem('BVX_PLAYLIST')||'[]');
    if(Array.isArray(p)) tracks = p;
    const last = parseInt(localStorage.getItem('BVX_LAST')||'-1',10);
    setNow(isNaN(last)?-1:last);
  }catch(e){}
  render();
}

// Controles
btnPlay.onclick = ()=> audio.paused ? audio.play() : audio.pause();
audio.onplay  = ()=> { btnPlay.textContent = '‚è∏'; setStatus('Tocando', true, false); };
audio.onpause = ()=> { btnPlay.textContent = '‚ñ∂Ô∏è'; setStatus('Pausado'); };
btnNext.onclick = ()=> tracks.length && playAt( (idx+1)%tracks.length );
btnPrev.onclick = ()=> tracks.length && playAt( (idx-1+tracks.length)%tracks.length );
vol.oninput = ()=> audio.volume = parseFloat(vol.value);
audio.ontimeupdate = ()=>{
  if(isFinite(audio.duration)) bar.style.width = (100*audio.currentTime/audio.duration).toFixed(1)+'%';
};
audio.onended = ()=> btnNext.click();

// Importar/Exportar/Limpar
btnImport.onclick = ()=> fileJson.click();
fileJson.onchange = async (e)=>{
  const f = e.target.files[0]; if(!f) return;
  try{
    const txt = await f.text();
    const arr = JSON.parse(txt);
    if(!Array.isArray(arr)) throw new Error('JSON inv√°lido');
    tracks = arr; save(); setStatus('Playlist importada', true, false);
    render(); setNow(0);
  }catch(err){ console.error(err); setStatus('Erro ao importar .json', false, true); alert('JSON inv√°lido. Use [{"title":"...","file":"..."}]'); }
};
btnExport.onclick = ()=>{
  const blob = new Blob([JSON.stringify(tracks,null,2)],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = Object.assign(document.createElement('a'),{href:url,download:'playlist.json'});
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
};
btnClear.onclick = ()=>{
  localStorage.removeItem('BVX_PLAYLIST'); localStorage.removeItem('BVX_LAST');
  tracks = []; idx = -1; render(); setNow(-1); setStatus('Sess√£o limpa', true, false);
};

// Carregar playlist.json (com cache-buster)
async function fetchPlaylist(){
  try{
    const res = await fetch('playlist.json?ts='+Date.now(), {cache:'no-store'});
    if(!res.ok) throw new Error('HTTP '+res.status);
    const data = await res.json();
    if(Array.isArray(data) && data.length){
      tracks = data; save(); setStatus('Playlist carregada', true, false);
    } else {
      setStatus('playlist.json vazio ‚Äî importe um .json', false, false);
    }
  }catch(err){
    console.error(err);
    setStatus('Erro ao carregar playlist.json ‚Äî use Importar .json', false, true);
  }
}

// Init
(async function init(){
  await fetchPlaylist();
  loadLocal();
})();
</script>
</body>
</html>
